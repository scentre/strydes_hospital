{"ast":null,"code":"/* eslint-disable no-underscore-dangle */\nimport axios from 'axios';\nimport { setCredentials } from '../store/auth/authSlice';\nlet store;\n\n// Recommended approach to avoid circular import dependency error\nexport const injectStore = _store => {\n  store = _store;\n};\nexport const apiErrorResponse = error => {\n  if (error.response) {\n    console.log(error.response.data);\n    console.log(error.response.status);\n    console.log(error.response.headers);\n  } else if (error.request) {\n    console.log(error.request);\n  } else {\n    console.log('Error', error.message);\n  }\n};\nconst instance = axios.create({\n  baseURL: 'http://localhost:3000',\n  withCredentials: true\n});\ninstance.interceptors.request.use(config => {\n  const {\n    accessToken\n  } = store.getState().auth;\n  if (accessToken) {\n    config.headers = {\n      Authorization: `Bearer ${accessToken}`,\n      Accept: 'application/json'\n    };\n  }\n  return config;\n}, err => Promise.reject(err));\nlet calledOnce = false;\ninstance.interceptors.response.use(response => {\n  return response;\n}, async error => {\n  const originalRequest = error.config;\n  if (error.response !== null) {\n    if (error.response.status === 403 && !originalRequest._retry) {\n      if (!calledOnce) {\n        calledOnce = true;\n        try {\n          const refreshData = await instance.get('/refresh_token/verify');\n          if (refreshData) {\n            const {\n              user\n            } = store.getState().auth;\n            axios.defaults.headers.common.Authorization = `Bearer ${refreshData.data.access_token}`;\n            store.dispatch(setCredentials({\n              user,\n              access_token: refreshData.data.access_token\n            }));\n            return instance(originalRequest);\n          }\n        } catch (error) {\n          if (error.response && error.response.data) {\n            return Promise.reject(error.response.data);\n          }\n          return Promise.reject(error);\n        } finally {\n          originalRequest._retry = true;\n          calledOnce = false;\n        }\n      }\n    }\n  }\n  return Promise.reject(error);\n});\nexport default instance;","map":{"version":3,"names":["axios","setCredentials","store","injectStore","_store","apiErrorResponse","error","response","console","log","data","status","headers","request","message","instance","create","baseURL","withCredentials","interceptors","use","config","accessToken","getState","auth","Authorization","Accept","err","Promise","reject","calledOnce","originalRequest","_retry","refreshData","get","user","defaults","common","access_token","dispatch"],"sources":["/home/ebuka/Documents/development/strydes_hospital/src/utils/axiosConfig.jsx"],"sourcesContent":["/* eslint-disable no-underscore-dangle */\nimport axios from 'axios';\nimport { setCredentials } from '../store/auth/authSlice';\n\nlet store;\n\n// Recommended approach to avoid circular import dependency error\nexport const injectStore = (_store) => {\n\tstore = _store;\n};\n\nexport const apiErrorResponse = (error) => {\n\tif (error.response) {\n\t\tconsole.log(error.response.data);\n\t\tconsole.log(error.response.status);\n\t\tconsole.log(error.response.headers);\n\t} else if (error.request) {\n\t\tconsole.log(error.request);\n\t} else {\n\t\tconsole.log('Error', error.message);\n\t}\n};\n\nconst instance = axios.create({\n\tbaseURL: 'http://localhost:3000',\n\twithCredentials: true\n});\n\ninstance.interceptors.request.use(\n\t(config) => {\n\t\tconst { accessToken } = store.getState().auth;\n\n\t\tif (accessToken) {\n\t\t\tconfig.headers = {\n\t\t\t\tAuthorization: `Bearer ${accessToken}`,\n\t\t\t\tAccept: 'application/json'\n\t\t\t};\n\t\t}\n\n\t\treturn config;\n\t},\n\t(err) => Promise.reject(err)\n);\n\nlet calledOnce = false;\n\ninstance.interceptors.response.use((response) => {\n\treturn response;\n}, async (error) => {\n\tconst originalRequest = error.config;\n\n\tif (error.response !== null) {\n\t\tif (error.response.status === 403 && !originalRequest._retry) {\n\t\t\tif (!calledOnce) {\n\t\t\t\tcalledOnce = true;\n\n\t\t\t\ttry {\n\t\t\t\t\tconst refreshData = await instance.get('/refresh_token/verify');\n\n\t\t\t\t\tif (refreshData) {\n\t\t\t\t\t\tconst { user } = store.getState().auth;\n\t\t\t\t\t\taxios.defaults.headers.common.Authorization = `Bearer ${refreshData.data.access_token}`;\n\n\t\t\t\t\t\tstore.dispatch(setCredentials({\n\t\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\taccess_token: refreshData.data.access_token\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t\treturn instance(originalRequest);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif (error.response && error.response.data) {\n\t\t\t\t\t\treturn Promise.reject(error.response.data);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.reject(error);\n\t\t\t\t} finally {\n\t\t\t\t\toriginalRequest._retry = true;\n\t\t\t\t\tcalledOnce = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn Promise.reject(error);\n});\n\nexport default instance;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}